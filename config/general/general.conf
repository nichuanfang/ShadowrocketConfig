[General]
# --- 基础连接设置 ---
# 旁路系统：防止推送延迟，保持系统级服务（如 APNs）直连
bypass-system = true

# 跳过代理：增加 198.18.0.0/15 (Fake IP 范围) 和更多国内关键地址
skip-proxy = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, 127.0.0.1, localhost, *.local, captive.apple.com, *.ccb.com, *.abchina.com.cn, *.psbc.com, www.baidu.com, *.163.com, *.jd.com, *.taobao.com, *.tmall.com, *.qhres.com, *.qhimg.com

# TUN 旁路路由：排除国内私有网段，确保局域网性能，增加 198.18.0.0/15
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.18.0.0/15, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32

# --- DNS 核心优化 ---
# 采用 DoH (DNS over HTTPS) 提高安全性，并保留系统 DNS 兼容性
# 格式：system, 阿里DoH, 腾讯DoH
dns-server = system, https://dns.alidns.com/dns-query, https://doh.pub/dns-query

# 强制直连域名使用系统 DNS，确保 CDN 调度最准确
dns-direct-system = true

# 开启隐私应答，防止 DNS 劫持导致的流量泄露
private-ip-answer = true

# 劫持常见公共 DNS，强制走 Shadowrocket 的 DNS 逻辑
hijack-dns = 8.8.8.8:53, 8.8.4.4:53, 1.1.1.1:53, 208.67.222.222:53

# --- 协议与 IP 策略 ---
# 2026年建议：开启 IPv6，但除非必要不优先。解决部分 App 启动慢的问题
ipv6 = true
prefer-ipv6 = false

# 禁用所有代理流量的 QUIC，解决 YouTube 掉速、Instagram 刷不出图的顽疾
# 强制 fallback 到 TCP 模式，速度更稳
block-quic = all-proxy

# UDP 不支持时自动直连，保证 Facetime/微信语音等实时通讯不中断
udp-policy-not-supported-behaviour = DIRECT

# 开启 DNS SVCB 支持，适配现代网站加速协议
allow-dns-svcb = true

# --- 兼容性与真实 IP ---
# 对特定系统服务强制使用真实 IP，防止推送或定位异常
always-real-ip = *.srv.nintendo.net, *.stun.playstation.net, *.msftconnecttest.com, *.msftncsi.com

# ICMP 自动回复，让延迟测试看起来更“漂亮”
icmp-auto-reply = true
